<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Adoucisseur d‚Äôeau ‚Äì Votre √©tude en ligne</title>
<meta name="description" content="Estimez vos √©conomies avec un adoucisseur d‚Äôeau install√© par un pro. √âtude 100 % en ligne : √âconomies, Dimensionnement, Prix." />

<!-- Pr√©chargement visuel -->
<link rel="preload" as="image"
  href="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/73662e00d6a2835c42e89f3296e3301141a52285/fond%20haut%20de%20page%20adou.webp"
  imagesizes="100vw" />

<style>
/* =================================================================
   VARIABLES (th√®me 2025)
   ================================================================= */
:root{
  --maxw: 1200px;
  --hero-h-desktop: 92vh;
  --hero-h-mobile: 96vh;

  /* Couleurs */
  --ink:#0f172a;               /* texte fonc√© sur blanc */
  --muted:#64748b;             /* texte secondaire */
  --line:#e5e7eb;              /* bordures fines */
  --card:#ffffff;              /* cartes (fond blanc) */
  --page:#ffffff;              /* page fond blanc √©pur√© */

  /* CTA bleu profond */
  --cta-top:#0b4fbf;
  --cta-bot:#0a2e70;
  --cta-ink:#ffffff;

  /* Badge prix (bleu clair moderne) */
  --badge:#e9f1ff;
  --badge-ink:#0a3ebf;

  /* Largeur commune bloc ‚Äúr√©sultats‚Äù */
  --w: 880px;
}
@media (max-width: 900px){ :root{ --w: 680px; } }
@media (max-width: 600px){ :root{ --w: min(92vw,560px); } }

/* =================================================================
   RESET + BODY
   ================================================================= */
*{ box-sizing:border-box; margin:0; padding:0; }
html,body{ height:100%; }
body{
  background:var(--page);
  color:var(--ink);
  font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Arial;
  -webkit-font-smoothing:antialiased;
  text-rendering:optimizeLegibility;
}

/* Skipper accessibilit√© */
.skip-link{
  position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden;
}
.skip-link:focus{
  position:fixed; left:16px; top:16px; width:auto; height:auto;
  padding:10px 14px; background:#111827; color:#fff; border-radius:8px; z-index:9999;
}

/* =================================================================
   LOGO
   ================================================================= */
.logo-header{ position:absolute; top:24px; left:24px; z-index:10; display:block; }
.logo-header img{ height:70px; width:auto; display:block; }
@media (max-width:900px){
  .logo-header{ top:16px; left:16px; }
  .logo-header img{ height:48px; }
}

/* =================================================================
   HERO (visuel haut)
   ================================================================= */
header.hero{
  position:relative; isolation:isolate; overflow:hidden;
  height:var(--hero-h-desktop); min-height:700px; display:flex; align-items:center;
  background:#0b1220; color:#fff;
}
@media (max-width:900px){
  header.hero{ height:var(--hero-h-mobile); min-height:640px; }
}
.hero__img{
  position:absolute; inset:0; z-index:-2; width:100%; height:100%;
  object-fit:cover; object-position:center 50%;
}
.hero::before{
  content:""; position:absolute; inset:0; z-index:-1;
  background:linear-gradient(180deg,rgba(14,165,233,.28) 0%,rgba(14,165,233,.18) 40%,rgba(0,0,0,.42) 100%);
  mix-blend-mode:soft-light;
}
.hero::after{
  content:""; position:absolute; inset:0; pointer-events:none;
  background:linear-gradient(to bottom,rgba(0,0,0,0) 78%,rgba(0,0,0,.78) 100%);
}
.hero__inner{
  width:100%; max-width:var(--maxw); margin:0 auto; padding:0 24px;
  display:grid; grid-template-columns:1fr auto; gap:32px; align-items:center;
}
@media (max-width:900px){ .hero__inner{ grid-template-columns:1fr; gap:20px; } }

.hero__copy{ max-width:680px; position:relative; z-index:1; }
.hero__intro{
  font-size:clamp(16px,1.6vw,20px); color:#e0f2fe; font-weight:700;
  margin-bottom:16px; text-shadow:0 1px 3px rgba(0,0,0,.45); text-wrap:balance;
}
.hero__copy h1{
  font-size:clamp(34px,4vw,52px); line-height:1.15; font-weight:800; margin:12px 0 14px;
  letter-spacing:-.3px; text-wrap:balance; text-shadow:0 2px 8px rgba(0,0,0,.35); max-width:680px; color:#f8fafc;
}
.hero__copy h1 em{ font-style:normal; color:var(--cta-top); }
.hero__copy p{ color:#e2e8f0; font-weight:600; }

/* Card formulaire (√† droite) */
.card{
  position:relative; width:456px; max-width:95vw; margin-right:2vw;
  background:rgba(10,15,25,.92); border:1px solid rgba(255,255,255,.28); border-radius:22px;
  backdrop-filter:blur(6px); -webkit-backdrop-filter:blur(6px);
  box-shadow:0 18px 60px rgba(0,0,0,.55), 0 6px 16px rgba(0,0,0,.35); overflow:hidden; z-index:2;
  align-self:center; margin-top:4vh; transform:translateY(10px);
}
@media (max-width:900px){
  .card{ margin:0 auto; max-width:640px; width:100%; background:#0b1220; transform:none; }
}
.card__head{
  text-align:center; padding:24px 22px 18px;
  background:linear-gradient(180deg,rgba(15,23,42,.98),rgba(11,18,32,.98));
  border-bottom:1px solid rgba(255,255,255,.32);
}
.card__head .t1{ display:block; font-weight:800; font-size:1.2rem; color:#fff; letter-spacing:.1px; }
.card__head .t2{ display:block; font-size:1rem; color:#fff; opacity:.98; margin-top:2px; }
.card__body{ padding:22px 20px 20px; }

.field{ display:flex; align-items:center; gap:12px; margin-bottom:16px; }
.field label{ font-weight:700; color:#fff; font-size:15px; }
.sel{
  flex:1; min-height:46px; padding:10px 12px; background:rgba(255,255,255,.08);
  color:#f8fafc; border:1px solid rgba(255,255,255,.28); border-radius:12px; outline:0; font-weight:600;
}
.sel option{ color:#111827; background-color:#ffffff; }
.chk{ display:flex; align-items:center; gap:8px; font-weight:600; color:#fff; }
.chk input{ width:18px; height:18px; position:relative; top:1px; }

.cta{
  display:block; width:100%; margin-top:12px; height:54px; border-radius:16px;
  border:1px solid rgba(255,255,255,.25);
  background:linear-gradient(180deg,var(--cta-top),var(--cta-bot));
  color:var(--cta-ink); font-weight:800; font-size:1.02rem;
  box-shadow:0 16px 36px rgba(11,63,145,.55), inset 0 2px 4px rgba(255,255,255,.08);
  cursor:pointer; transition:transform .15s ease, filter .15s ease;
}
.cta:hover{ filter:brightness(1.06); transform:translateY(-2px); }

/* =================================================================
   SECTION R√âSULTATS ‚Äî fond blanc, espacement fluide
   ================================================================= */
#recap{
  background:#fff; color:var(--ink);
  border:1px solid var(--line); border-radius:14px;
  max-width:var(--w); margin:40px auto 0; padding:24px 18px 6px;
  box-shadow:0 8px 24px rgba(2,6,23,.06);
  display:none;
}

/* Bloc ‚ÄúLe calcaire vous co√ªte‚Ä¶‚Äú */
.rc{
  background:var(--cta-top); color:#fff; border-radius:14px;
  padding:22px 20px; text-align:center;
  max-width:var(--w); width:100%; margin:0 auto 16px; box-shadow:0 8px 18px rgba(10,30,80,.12);
  display:none;
}
.rc__title{ font-size:1.1rem; font-weight:700; margin:0 0 8px; }
.rc__value{ font-size:3rem; font-weight:800; line-height:1; }
.rc__sub{ font-size:1rem; opacity:.95; margin-top:4px; }
.rc__arrow{ display:flex; justify-content:center; margin:12px 0 0; }
.rc__arrow svg{ width:70px; height:36px; }
.rc__arrow path{ fill:none; stroke:#fff; stroke-width:3; stroke-linejoin:round; }

/* Trois cartes bleues */
.rc-cards{
  display:flex; flex-direction:column; gap:14px; max-width:var(--w);
  margin:0 auto 8px; padding:0;
}
.rc-card{
  display:flex; align-items:flex-end; justify-content:center; gap:12px;
  background:#1353C9; color:#fff; border-radius:12px; padding:16px 18px;
  box-shadow:0 8px 18px rgba(10,30,80,.12); width:100%; margin:0 auto;
}
.rc-card__icon{ flex:0 0 28px; display:flex; align-items:center; justify-content:center; }
.rc-card__icon svg{ width:24px; height:24px; }
.rc-card__body{ display:grid; row-gap:4px; justify-items:center; text-align:center; }
.rc-card__value{ font-size:clamp(24px,3.2vw,34px); line-height:1.1; }

/* Slogan + trait fin */
#rc-slogan{
  text-align:center; font-size:1.3rem; line-height:1.3; font-weight:900; color:#0a3ebf;
  margin:24px auto 18px; max-width:780px;
}
.slogan-sep{
  width:clamp(200px,55%,480px); height:4px; background:var(--cta-top);
  border-radius:999px; margin: 10px auto 22px;
}

/* Bloc produit (fond blanc, respirant) */
.prod{
  background:#fff;
  max-width:var(--w);
  margin: 0 auto;
  padding: 10px 0 0;
}
.prod__inner{
  width:100%;
  margin:0 auto;
  display:grid;
  grid-template-columns: 420px 1fr;
  gap:28px;
  align-items:center;
}
.prod__img{ width:100%; max-width:360px; height:auto; display:block; margin:0 auto; }
.prod__title{ font-weight:900; font-size:clamp(20px,2.8vw,28px); color:#0f172a; margin:0 0 10px; }
.prod__specs{ list-style:none; margin:0 0 12px; padding:0; }
.prod__specs li{ color:#1e293b; line-height:1.55; margin:6px 0; font-size:.96rem; }

/* Badge prix all√©g√© */
.prod__price{
  display:inline-flex; align-items:center; gap:8px;
  background:var(--badge); color:var(--badge-ink);
  border:1px solid #cfe0ff; border-radius:12px;
  padding:10px 14px; font-weight:800;
}
.prod__price .prod__amount{ font-size:clamp(24px,4.4vw,34px); line-height:1.1; }

/* Responsive produit */
@media (max-width:900px){
  .prod__inner{ grid-template-columns:1fr; text-align:center; gap:18px; }
  .prod__img{ max-width:300px; }
}

/* Bloc autofinancement : a√©r√© */
.autofin{
  background:#fff;
  max-width:var(--w);
  margin: 18px auto 26px;
  padding: 0 0 8px;
  text-align:center;
}
.autofin__line{
  font-weight:900;
  font-size:clamp(20px,2vw,26px);
  line-height:1.25;
  color:#0f172a;
}
.autofin__line + .autofin__line{ margin-top:4px; }
.autofin .v{ color:var(--cta-top); }

/* Carte financement */
.fin-card{
  border:1px solid var(--line);
  border-radius:14px;
  padding:20px 24px;
  max-width:720px;
  margin:18px auto 0;
  background:#fff;
  box-shadow:0 6px 16px rgba(2,6,23,.05);
}
.fin-list{
  display:grid; grid-template-columns: 1fr auto;
  gap:10px 18px; text-align:left; align-items:center;
}
.fin-list dt{ color:#0f172a; font-weight:700; }
.fin-list dd{ margin:0; font-weight:800; color:var(--cta-top); }
.fin-legal{ margin-top:12px; font-size:13px; color:#64748b; }

/* =================================================================
   SECTIONS ‚Äúp√©dagogie‚Äù sous le r√©sultat (masqu√©es apr√®s calcul)
   ================================================================= */
.section{ padding:70px 20px; }
.section__inner{ max-width:1100px; margin:0 auto; }
.section h2{ font-size:clamp(26px,4.2vw,44px); line-height:1.15; font-weight:900; margin-bottom:8px; }
.section .subtitle{ color:#64748b; margin-bottom:32px; }

/* FOOTER BLEU ‚Äî il doit respirer, on force une marge-top saine depuis la zone r√©sultats */
.footer-cta{
  background:linear-gradient(180deg,var(--cta-top),var(--cta-bot));
  color:#fff; padding:56px 20px;
  margin-top: 46px;                /* respiration avant le bas de page */
}
.footer-cta__inner{
  max-width:1100px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:40px; flex-wrap:wrap;
}
.footer-cta__left{ flex:0 0 340px; display:flex; align-items:center; justify-content:center; }
.footer-cta__img{ max-width:100%; height:auto; display:block; filter:drop-shadow(0 6px 16px rgba(0,0,0,.25)); }
.footer-cta__right{ flex:1; min-width:260px; text-align:left; }
.footer-cta__right h2{ font-size:clamp(20px,2.6vw,28px); margin-bottom:10px; font-weight:800; }
.footer-cta__right p{ font-size:16px; margin-bottom:18px; line-height:1.55; }
.footer-cta__right .cta{
  display:inline-block; background:linear-gradient(180deg,var(--cta-top),var(--cta-bot)); color:#fff; font-weight:700; padding:14px 22px;
  border-radius:14px; text-decoration:none; box-shadow:0 8px 22px rgba(6,182,212,.25); transition:filter .25s ease;
}
.footer-cta__right .cta:hover{ filter:brightness(1.1); }
.footer-cta__trust{ font-size:13px; margin-top:10px; opacity:.9; }
.footer-legal{ text-align:center; margin-top:32px; font-size:13px; color:rgba(255,255,255,.9); }

/* Impression (r√©sum√© uniquement si besoin) ‚Äî minimal */
@media print{
  header, .section, .footer-cta{ display:none !important; }
  #recap, .rc, .rc-cards, .prod, .autofin{ display:block !important; box-shadow:none !important; border-color:#ddd; }
}
</style>
</head>
<body>
<a href="#main" class="skip-link">Aller au contenu</a>

<!-- ========================= HERO ========================= -->
<header id="hero" class="hero" aria-label="Haut de page adoucisseur d‚Äôeau">
  <a class="logo-header" role="img" aria-label="Solution Eau Pro">
    <img src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/73662e00d6a2835c42e89f3296e3301141a52285/LOGO%20SEP2.webp" alt="Solution Eau Pro" />
  </a>

  <img class="hero__img"
       src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/73662e00d6a2835c42e89f3296e3301141a52285/fond%20haut%20de%20page%20adou.webp"
       alt="" width="1920" height="1080" loading="eager" decoding="async" fetchpriority="high" sizes="100vw" />

  <div class="hero__inner">
    <div class="hero__copy">
      <p class="hero__intro">Dites adieu au calcaire, red√©couvrez une eau pure et douce.</p>
      <h1><em>Adoucisseur d‚Äôeau</em> install√© par un professionnel local</h1>
      <p>√âtude rapide, prix clair et installation garantie constructeur.</p>
    </div>

    <!-- ========= Formulaire ========= -->
    <section id="lead-form" role="region" aria-labelledby="formTitle" class="card">
      <header class="card__head">
        <span id="formTitle" class="t1">Votre √©tude 100 % en ligne&nbsp;:</span>
        <span class="t2">√âconomies ‚Ä¢ Dimensionnement ‚Ä¢ Prix</span>
      </header>
      <div class="card__body">
        <form id="form-estimation" action="#" onsubmit="return false" novalidate>
          <div class="field">
            <label for="foyer">Taille du foyer</label>
            <select id="foyer" name="foyer" class="sel" required>
              <option value="" disabled selected hidden>Choisir‚Ä¶</option>
              <option value="1-2">1 √† 2 personnes</option>
              <option value="3-4">3 √† 4 personnes</option>
              <option value="5+">5 personnes ou plus</option>
            </select>
          </div>

          <div class="field">
            <label class="chk" for="peau">
              <input id="peau" name="peau_seche" type="checkbox" value="1" />
              Peau s√®che / r√™che
            </label>
          </div>

          <button class="cta" type="submit">Calculer mon gain</button>
        </form>
      </div>
    </section>
  </div>
</header>

<!-- ========================= R√âSULTATS (Affich√©s apr√®s calcul) ========================= -->
<section id="recap" aria-live="polite">
  <!-- Bloc co√ªt annuel -->
  <section id="resume-cout" class="rc" aria-label="R√©sum√© co√ªt du calcaire" style="display:none">
    <div class="rc__content">
      <h3 class="rc__title">Le calcaire vous co√ªte chaque ann√©e‚Ä¶</h3>
      <div class="rc__value" id="rc-annual">0 ‚Ç¨</div>
      <div class="rc__sub">Soit <strong id="rc-10ans">0 ‚Ç¨</strong> sur 10 ans</div>
      <div class="rc__arrow" aria-hidden="true">
        <svg viewBox="0 0 24 14" role="img" focusable="false"><path d="M1 1 H23 L12 13 Z"/></svg>
      </div>
    </div>
  </section>

  <!-- 3 cartes d√©taill√©es -->
  <section id="rc-cards" class="rc-cards" aria-label="D√©tail du co√ªt annuel">
    <article class="rc-card">
      <div class="rc-card__icon" aria-hidden="true">
        <svg viewBox="0 0 48 48" width="48" height="48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M39 10h4M38 14h5" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
          <path d="M20 10h8l1 3v4h-10v-4l1-3Z" stroke="#fff" stroke-width="2" stroke-linejoin="round"/>
          <rect x="18" y="17" width="12" height="20" rx="3" stroke="#fff" stroke-width="2"/>
          <rect x="8" y="20" width="8" height="17" rx="2" stroke="#fff" stroke-width="2"/>
        </svg>
      </div>
      <div class="rc-card__body">
        <div class="rc-card__value"><span id="rc-val-prod">0</span> ‚Ç¨</div>
        <div class="rc-card__text">Surconsommation de produits d‚Äôentretien pour la maison et le corps</div>
      </div>
    </article>

    <article class="rc-card">
      <div class="rc-card__icon" aria-hidden="true">
        <svg viewBox="0 0 48 48" width="48" height="48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M24 4a10 10 0 0 1 6 18v6h-12v-6a10 10 0 0 1 6-18Z" stroke="#fff" stroke-width="2"/>
          <path d="M20 40h8v4h-8z" fill="#fff"/>
        </svg>
      </div>
      <div class="rc-card__body">
        <div class="rc-card__value"><span id="rc-val-energie">0</span> ‚Ç¨</div>
        <div class="rc-card__text">Surconsommation d‚Äô√©nergie pour chauffer une eau entartr√©e</div>
      </div>
    </article>

    <article class="rc-card">
      <div class="rc-card__icon" aria-hidden="true">
        <svg viewBox="0 0 48 48" width="48" height="48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="24" cy="24" r="6" stroke="#fff" stroke-width="2"/>
          <path d="M24 6v4M24 38v4M6 24h4M38 24h4M12 12l3 3M33 33l3 3M12 36l3-3M33 15l3-3" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="rc-card__body">
        <div class="rc-card__value"><span id="rc-val-materiel">0</span> ‚Ç¨</div>
        <div class="rc-card__text">Co√ªt de la d√©gradation du mat√©riel et des canalisations</div>
      </div>
    </article>
  </section>

  <!-- Slogan + trait -->
  <p id="rc-slogan">
    L‚Äôadoucisseur <strong>Solution Eau Pro</strong><br>
    la solution anti-calcaire pour une eau plus douce qui all√®ge votre budget.
  </p>
  <div class="slogan-sep" role="presentation" aria-hidden="true"></div>

  <!-- Bloc produit recommand√© (respirant) -->
  <section id="prod" class="prod" aria-label="Votre adoucisseur recommand√©" style="display:none">
    <div class="prod__inner">
      <div>
        <img class="prod__img"
             src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/d225be165d82d1a79a704e583120eb2813ff6932/neaqua%20vague%20fond%20t.webp"
             alt="Adoucisseur d‚Äôeau recommand√©" loading="lazy" />
      </div>
      <div>
        <h3 class="prod__title">
          Votre adoucisseur <span id="prod-capacite">‚Äî</span> ‚Ä¢
          <span id="prod-modele">‚Äî</span>
        </h3>
        <ul class="prod__specs">
          <li>Vanne volum√©trique Fleck</li>
          <li>R√©g√©n√©ration volum√©trique</li>
          <li>Installation & mise en service incluses</li>
        </ul>
        <div class="prod__price">
          <span>Prix install√© d√®s</span>
          <span class="prod__amount" id="prod-prix">‚Äî</span>
          <span>TTC</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Bloc autofinancement (a√©r√©) -->
  <section id="autofin" class="autofin" aria-label="Comparatif √©conomies / financement" style="display:none">
    <p class="autofin__line">
      Plut√¥t que de perdre <span id="af-total" class="v">‚Äî</span> / an √† cause du calcaire,
    </p>
    <p class="autofin__line">
      investissez-les dans votre confort.
    </p>

    <div class="fin-card" aria-label="D√©tails de financement (facultatif)">
      <dl class="fin-list">
        <dt>Prix install√©</dt>                    <dd><span id="fin-capital">‚Äî</span> TTC</dd>
        <dt>Mensualit√© (hors assurance)</dt>      <dd><span id="fin-mensu">‚Äî</span> / mois</dd>
        <dt>Dur√©e</dt>                             <dd><span id="fin-duree">‚Äî</span> mois</dd>
        <dt>TAEG</dt>                              <dd><span id="fin-taeg">‚Äî</span> %</dd>
        <dt>Montant total d√ª</dt>                 <dd><span id="fin-total">‚Äî</span></dd>
      </dl>
      <p class="fin-legal">
        Un cr√©dit vous engage et doit √™tre rembours√©. V√©rifiez vos capacit√©s de remboursement avant de vous engager.
      </p>
    </div>
  </section>
</section>

<main id="main" tabindex="-1">
  <!-- Sections p√©dagogiques (masqu√©es apr√®s simulation) -->
  <section class="section" data-hide-after-sim="1">
    <div class="section__inner">
      <h2>Simulation en ligne : rapide, fiable et sans engagement</h2>
      <p class="subtitle">Des r√©sultats clairs en 3 √©tapes.</p>
      <!-- (contenu facultatif, volontairement r√©duit pour rester concis) -->
    </div>
  </section>
</main>

<!-- ========================= FOOTER BLEU (respiration avant) ========================= -->
<footer class="footer-cta" aria-labelledby="footerTitle">
  <div class="footer-cta__inner">
    <div class="footer-cta__left">
      <img
        src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/d7b8d505509e7dffe108d879ad5b25b19b1f39b1/camion%20%20poseur%20SEP.webp"
        alt="Camion Solution Eau Pro avec technicien installateur"
        class="footer-cta__img" loading="lazy"
      />
    </div>
    <div class="footer-cta__right">
      <h2 id="footerTitle">Un installateur proche de chez vous, pr√™t √† intervenir</h2>
      <p>Pose rapide, mise en service incluse et suivi client garanti.</p>
      <a href="#lead-form" class="cta">üíß Je fais ma simulation</a>
      <div class="footer-cta__trust">Simulation sans engagement ‚Äì R√©ponse sous 24 h</div>
    </div>
  </div>
  <div class="footer-legal">Mentions l√©gales ‚Äì Solution Eau Pro ¬∑ Biofrance √ânergies</div>
</footer>

<!-- ========================= JS ‚Äî Calcul & affichage ========================= -->
<script>
/* Table des financements (tarifs -> mensualit√© / total) */
const FINANCE = {
  2200: { mensu: 31.93, total: 2682.08 },
  2400: { mensu: 34.84, total: 2925.76 },
  2600: { mensu: 37.74, total: 3169.68 }
};
const DUREE_MOIS = 84;
const TAEG_PCT   = 5.96;

document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("form-estimation");
  if(!form) return;

  form.addEventListener("submit", (ev) => {
    ev.preventDefault();

    // Entr√©es
    const foyerVal = (document.getElementById("foyer")?.value || "").trim();
    const n = foyerVal === "1-2" ? 2 : foyerVal === "3-4" ? 4 : foyerVal === "5+" ? 5 : 0;
    const peau = !!document.getElementById("peau")?.checked;
    if (!n) { alert("S√©lectionnez la taille du foyer."); document.getElementById("foyer")?.focus(); return; }

    // Hypoth√®ses (coh√©rentes avec ta page)
    const PRIX_KWH = 0.27, ECS_KWH_PP = 800, TAUX_GAIN_ECS = 0.10;
    const DEPENSE_PROD_PP = 220, TAUX_ECO_PROD = peau ? 0.45 : 0.35;
    const SAVE_MAT_FOYER = 80;

    // Calculs
    const baseProduits = n * DEPENSE_PROD_PP;
    const sProd = Math.round(baseProduits * TAUX_ECO_PROD);
    const sEnergie = Math.round(n * ECS_KWH_PP * PRIX_KWH * TAUX_GAIN_ECS);
    const sMateriel = SAVE_MAT_FOYER;
    const total = sProd + sEnergie + sMateriel;

    // Projection 10 ans avec 5%/an sur la partie √©nergie
    const r = 1.05, years = 10;
    const sommeGeo = (Math.pow(r, years) - 1) / (r - 1);
    const total10 = Math.round(sProd * 10 + sMateriel * 10 + sEnergie * sommeGeo);

    // Affichage bloc r√©sultats
    const recap = document.getElementById("recap");
    if (recap) recap.style.display = "block";

    const rc = document.getElementById("resume-cout");
    const rcAnnual = document.getElementById("rc-annual");
    const rc10 = document.getElementById("rc-10ans");
    if (rc && rcAnnual && rc10) {
      rcAnnual.textContent = `${total.toLocaleString("fr-FR")} ‚Ç¨`;
      rc10.textContent = `${total10.toLocaleString("fr-FR")} ‚Ç¨`;
      rc.style.display = "block";
    }

    // D√©tail cartes
    const valeurs = [sProd, sEnergie, sMateriel];
    ["rc-val-prod","rc-val-energie","rc-val-materiel"].forEach((id,i)=>{
      const el = document.getElementById(id);
      if(el) el.textContent = Math.round(valeurs[i]).toLocaleString("fr-FR");
    });

    // S√©lection du mod√®le et tarif
    let modele, tarif;
    if (n <= 2)      { modele = "Adoucisseur d‚Äôeau 10 L de r√©sine"; tarif = 2200; }
    else if (n <= 4) { modele = "Adoucisseur d‚Äôeau 15 L de r√©sine"; tarif = 2400; }
    else             { modele = "Adoucisseur d‚Äôeau 20 L de r√©sine"; tarif = 2600; }

    // Bloc produit
    const prod = document.getElementById("prod");
    if (prod) {
      prod.style.display = "block";
      const capSpan  = document.getElementById("prod-capacite");
      const modSpan  = document.getElementById("prod-modele");
      const prixSpan = document.getElementById("prod-prix");
      if (capSpan)  capSpan.textContent  = (modele.match(/\d+\s?L/)?.[0] || "");
      if (modSpan)  modSpan.textContent  = "Vanne volum√©trique Fleck";
      if (prixSpan) prixSpan.textContent = (tarif.toLocaleString("fr-FR")) + " ‚Ç¨";
    }

    // Bloc autofinancement
    const af = document.getElementById("autofin");
    if (af) {
      const afTotal = document.getElementById("af-total");
      if (afTotal) afTotal.textContent = total.toLocaleString("fr-FR") + " ‚Ç¨";

      const fin = FINANCE[tarif];
      const elCap  = document.getElementById("fin-capital");
      const elMen  = document.getElementById("fin-mensu");
      const elDur  = document.getElementById("fin-duree");
      const elT    = document.getElementById("fin-taeg");
      const elTot  = document.getElementById("fin-total");

      if (fin && elCap && elMen && elDur && elT && elTot) {
        const fmt2 = { minimumFractionDigits:2, maximumFractionDigits:2 };
        elCap.textContent = tarif.toLocaleString("fr-FR");
        elMen.textContent = fin.mensu.toLocaleString("fr-FR", fmt2);
        elDur.textContent = String(DUREE_MOIS);
        elT.textContent   = TAEG_PCT.toLocaleString("fr-FR", fmt2);
        elTot.textContent = fin.total.toLocaleString("fr-FR", fmt2) + " ‚Ç¨";
      }
      af.style.display = "block";
    }

    // Masquer les sections p√©dagogiques
    document.querySelectorAll('[data-hide-after-sim="1"]').forEach(el=> el.style.display = "none");

    // Scroll vers r√©sultats
    recap?.scrollIntoView({ behavior:"smooth", block:"start" });
  });
});
</script>
</body>
</html>
